# Please sync all changes to <root>/oxideshop/source/.htaccess
{{ authblock }}
{% if oxid.environment_name == 'production' %}
    # No rules defined.
{% endif %}
{% if oxid.environment_name == 'staging' %}
    # No rules defined.
{% endif %}
{% if oxid.environment_name == 'integration' %}
    # No rules defined.
{% endif %}
# OXID defaults -->
<IfModule mod_rewrite.c>
    Options +FollowSymLinks
    RewriteEngine On
    RewriteBase /

    # Angry Alligator -->
    RewriteCond %{QUERY_STRING} (^|\&)sorting\=[^\&]+(\&|$) [NC]
    RewriteCond %{QUERY_STRING} !(^|\&)sorting\=[a-z]+(\&|$) [NC]
    RewriteRule .* - [F]
    # <-- Angry Alligator

    RewriteCond %{REQUEST_URI}     config\.inc\.php [NC]
    RewriteRule ^config\.inc\.php  index\.php       [R=301,L]

    RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
    RewriteRule .* - [F]

    RewriteCond %{REQUEST_URI} oxseo\.php$
    RewriteCond %{QUERY_STRING} mod_rewrite_module_is=off
    RewriteRule oxseo\.php$ oxseo.php?mod_rewrite_module_is=on [L]

    RewriteRule ^(vendor/) - [F,L,NC]

    RewriteCond %{REQUEST_URI}   ^\/oxid\/
    RewriteRule oxid\/(.*) $1 [L]

    RewriteCond %{REQUEST_URI} (\/out\/pictures\/generated\/)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule (\.jpe?g|\.gif|\.png|\.svg)$ getimg.php [L]

    RewriteCond %{REQUEST_URI} !(\/admin\/|\/core\/|\/Application\/|\/export\/|\/modules\/|\/out\/|\/setup\/|\/tmp\/|\/views\/)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule .* oxseo.php
</IfModule>

# disabling log file access from outside
<FilesMatch "(EXCEPTION_LOG\.txt|\.log|\.tpl|pkg\.rev|\.ini|pkg\.info|\.pem|composer\.json|composer\.lock|test_config\.yml)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Prevent .ht* files from being sent to outside requests
<Files ~ "^\.ht">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

# Set http cache headers (#ZLAB-8205)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access 1 year"
  ExpiresByType image/jpeg "access 1 year"
  ExpiresByType image/gif "access 1 year"
  ExpiresByType image/png "access 1 year"
  ExpiresByType image/x-icon "access 1 year"
  ExpiresByType text/css "access 1 month"

  # using only one minute expires header because AEM will not add a timestamp to url from staticly included js files
  ExpiresByType application/javascript "access 1 minute"

  # Not using  ExpiresDefault "access 1 month" because nobody should get confused again
  # by accedetly cached files (better have them listed)
</IfModule>

Options -Indexes
DirectoryIndex index.php index.html
